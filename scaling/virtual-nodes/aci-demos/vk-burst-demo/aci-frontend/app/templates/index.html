<!-- By Sam Kreter
For use by Microsoft and other parties to demo
Azure Container Service, Azure Container Instances
and the experimental ACI-connector -->
<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="/static/dashboard/assets/img/apple-icon.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/static/dashboard/assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Facial Recognition App</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />


    <!-- Bootstrap core CSS     -->
    <link href="/static/dashboard/assets/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Animation library for notifications   -->
    <link href="/static/dashboard/assets/css/animate.min.css" rel="stylesheet" />

    <!--  Paper Dashboard core CSS    -->
    <link href="/static/dashboard/assets/css/paper-dashboard.css" rel="stylesheet" />


    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="/static/dashboard/assets/css/demo.css" rel="stylesheet" />


    <!--  Fonts and icons     -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href='https://fonts.googleapis.com/css?family=Muli:400,300' rel='stylesheet' type='text/css'>
    <link href="/static/dashboard/assets/css/themify-icons.css" rel="stylesheet">

    <style>
        .navbar-default, .main-panel {
            background-color: #fefcff;
        }
        .main-card {
            background: #eee;
        }
        .icon-folder-color{
            color: #ff8c00
        }
        #modal-box {
            width: 1090px;
        }
        html, body, h1, .h1, h2, .h2, h3, .h3, h4, .h4, h5, .h5, h6, .h6, p, .navbar, .brand, a, .td-name, td {
            font-family: 'Segoe UI', SegoeUI, "Helvetica Neue", Helvetica, Arial, sans-serif
        }
        .microsoft-logo {
            background-image: url("/static/dashboard/assets/img/Microsoft-Logo-PNG.png");
            background-size: 270px 100px;
            width: 270px;
            height: 100px;
        }
    </style>

</head>

<body>

    <div class="wrapper">

        <div class="main-panel">
            <nav class="navbar navbar-default">
                <div class="container-fluid">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar bar1"></span>
                            <span class="icon-bar bar2"></span>
                            <span class="icon-bar bar3"></span>
                        </button>
                        <a class="navbar-brand" href="#">Facial Recognition App</a>
                        <button id="reset-btn" type="button" class="btn btn-outline-secondary">Reset Database</button>
                    </div>
                    <div class="pull-right">
                        <div class="microsoft-logo" title="Microsoft"></div>
                    </div>
                </div>
            </nav>


            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-lg-3 col-sm-6">
                            <div class="card">
                                <div class="content">
                                    <div class="row">
                                        <div class="col-xs-5">
                                            <div class="icon-big icon-warning text-center">
                                                <i class="ti-timer"></i>
                                            </div>
                                        </div>
                                        <div class="col-xs-7">
                                            <div class="numbers">
                                                <p>Time to Complete Work</p>
                                                <span id="total_time">0</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="footer">
                                        <hr />
                                        <div class="stats">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6">
                            <div class="card">
                                <div class="content">
                                    <div class="row">
                                        <div class="col-xs-5">
                                            <div class="icon-big icon-success text-center">
                                                <i class="ti-image"></i>
                                            </div>
                                        </div>
                                        <div class="col-xs-7">
                                            <div class="numbers">
                                                <p>Pictures Processed</p>
                                                <span id="pic-num">0</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="footer">
                                        <hr />
                                        <div class="stats">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-sm-6">
                            <div class="card">
                                <div class="content">
                                    <div class="row">
                                        <div class="col-xs-5">
                                            <div class="icon-big icon-danger text-center">
                                                <i class="ti-stats-up"></i>
                                            </div>
                                        </div>
                                        <div class="col-xs-7">
                                            <div class="numbers">
                                                <p>Processed Per Second</p>
                                                <span id="pic-rate">0</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="footer">
                                        <hr />
                                        <div class="stats">

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-9">
                            <div class="card">
                                <div class="header">
                                    <h4 class="title">View Results</h4>
                                    <p class="category">24 Hours performance</p>
                                </div>
                                <div class="content">
                                    <div class="row">
                                        <div class="col-md-4 offset-md-3">
                                            <div id="detection-pics" class="card main-card">
                                                <div class="content">
                                                    <div class="row">
                                                        <div class="col-xs-5">
                                                            <div class="icon-big icon-folder-color text-center">
                                                                <i class="ti-folder"></i>
                                                            </div>
                                                        </div>
                                                        <div class="col-xs-7">
                                                            <div class="numbers">
                                                                Faces
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-4 offset-md-3">
                                            <div id="all-pics" class="card main-card">
                                                <div class="content">
                                                    <div class="row">
                                                        <div class="col-xs-5">
                                                            <div class="icon-big icon-folder-color text-center">
                                                                <i class="ti-folder"></i>
                                                            </div>
                                                        </div>
                                                        <div class="col-xs-7">
                                                            <div class="numbers">
                                                                No Faces
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-9">
                            <div class="card">
                                <canvas id="rate-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>




            <footer class="footer">
                <div class="container-fluid">
                    <nav class="pull-left">
                        <ul>
                            <li>
                                <a href="//www.creative-tim.com/license">
                                    Licenses
                                </a>
                            </li>
                        </ul>
                    </nav>
                    <div class="copyright pull-right">
                            &copy; Samuel Kreter with base by
                            <a href="//www.creative-tim.com">Creative Tim</a>
                    </div>
                </div>
            </footer>

        </div>
    </div>



    <div class="modal fade" id="detection-model" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" id="modal-box" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Detection</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="row text-center text-lg-left">

                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-1" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-2" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-3" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-4" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-5" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-6" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-7" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-8" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-9" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-10" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-11" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="d-12" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="all-pics-model" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" id="modal-box" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">All Pictures</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">

                    <div class="row text-center text-lg-left">

                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-1" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-2" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-3" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-4" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-5" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-6" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-7" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-8" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-9" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-10" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-11" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-4 col-xs-6">
                            <a href="#" class="d-block mb-4 h-100">
                                <img id="all-12" class="img-fluid img-thumbnail" src="//placehold.it/400x300" alt="">
                            </a>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

</body>

<!--   Core JS Files   -->
<script src="/static/dashboard/assets/js/jquery-1.10.2.js" type="text/javascript"></script>
<script src="/static/dashboard/assets/js/bootstrap.min.js" type="text/javascript"></script>

<script>
    //Activates the modal for the images that have faces in them
    $('#detection-pics').on('click', function (event) {
        $('#detection-model').modal('toggle');
    });

    //Activates the modal for all images
    $('#all-pics').on('click', function (event) {
        $('#all-pics-model').modal('toggle');
    });

    $('#reset-btn').on('click', function () {
        $.ajax({
            type: 'GET',
            url: "/resetDb",
            success: function (fullData, textStatus, jqXHR) {
                console.log("Reset the database");
            }
        });
    })

    function localTimeString(utcTime) {
        // time format: 2018-03-26 01:53:13.907861
        utcTime = utcTime.replace(' ', 'T');
        var utcDate = new Date(utcTime +"Z");
        return ('0' + utcDate.getHours()).slice(-2)
            + ':' + ('0' + utcDate.getMinutes()).slice(-2)
            + ':' + ('0' + utcDate.getSeconds()).slice(-2);
    }

    //Add auto updating code for the numbers
    $(function () {
        var ctx = document.getElementById('rate-chart').getContext('2d');

        var config = {
            // The type of chart we want to create
            type: 'line',

            // The data for our dataset
            data: {
                labels: [],
                datasets: [{
                    label: "Picture Process Rate",
                    fill: false,
                    yAxisID: 'y-axis-1',
                    borderColor: '#6917aa',
                    data: [],
                }]
            },

            // Configuration options go here
            options: {
                scales: {
						yAxes: [{
							type: 'linear', // only linear but allow scale type registration. This allows extensions to exist solely for log scale for instance
							display: true,
							position: 'left',
							id: 'y-axis-1',
						}],
					}                
            }
        };
        var chart = new Chart(ctx, config); 

        setInterval(function () {
            $.ajax({
                type: 'GET',
                dataType: "json",
                url: "/getProgress",
                success: function (fullData, textStatus, jqXHR) {
                    if(fullData['success']){
                        
                        var detected = 1;
                        var all = 1;

                        total_time = fullData['total_period']
                        seconds = Math.floor(total_time % 60)
                        minutes = Math.floor(total_time / 60)
                        speed_time = localTimeString(fullData['speed_time']);
                        data = fullData['pictures']
                        console.log(data)

                        pic_rate = (fullData['speed']).toPrecision(4)

                        $("#pic-num").text(data.length)

                        $("#total_time").text(minutes + "m " + seconds + "s")

                        $("#pic-rate").text(pic_rate);
                        if (total_time > 0)
                        {
                            config.data.labels.push(speed_time);
                            config.data.datasets[0].data.push({
                                x: speed_time,
                                y: pic_rate
                            });
                        }

                        chart.update();

                        for (var i = data.length - 1; i >= 1; i--) {
                            if (data[i].detected == 1 && detected < 13) {

                                $("#d-" + detected).attr('src', "https://acidemopictures.blob.core.windows.net/pictures/" + data[i].filename);
                                detected++;

                            }
                            else if (all < 13) {

                                $("#all-" + all).attr('src', "https://acidemopictures.blob.core.windows.net/pictures/" + data[i].filename);
                                all++;
                            }
                            else {
                                continue;
                            }
                        }
                    }
                },
                error: function (responseData, textStatus, errorThrown) {
                    console.log(errorThrown)
                    console.log('POST failed.');
                }
            });
        }, 1000);
    });


</script>


<!--  Checkbox, Radio & Switch Plugins -->
<script src="/static/dashboard/assets/js/bootstrap-checkbox-radio.js"></script>

<!--  Charts Plugin -->
<script src="/static/dashboard/assets/js/chartist.min.js"></script>

<!--  Notifications Plugin    -->
<script src="/static/dashboard/assets/js/bootstrap-notify.js"></script>

<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js"></script>

<!-- Paper Dashboard Core javascript and methods for Demo purpose -->
<script src="/static/dashboard/assets/js/paper-dashboard.js"></script>

<!-- Paper Dashboard DEMO methods, don't include it in your project! -->
<script src="/static/dashboard/assets/js/demo.js"></script>

<!-- Chart.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.js"></script>
</html>
